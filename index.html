<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador Clash Meta Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white min-h-screen py-8 px-4">
  <div class="max-w-6xl mx-auto">
    <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl">
      <h1 class="text-4xl font-bold mb-2 text-center bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
        ‚ö° Generador Clash Meta Profesional
      </h1>
      <p class="text-center text-gray-400 mb-6">Configuraci√≥n avanzada con reglas completas</p>
      
      <div class="grid md:grid-cols-2 gap-6 mb-6">
        <div class="bg-gray-700 p-4 rounded-lg">
          <h2 class="text-lg font-semibold mb-3 flex items-center">
            <span class="mr-2">üîß</span> Configuraci√≥n General
          </h2>
          <div class="space-y-3">
            <div>
              <label class="block text-sm mb-1">Nombre del perfil:</label>
              <input id="profileName" type="text" value="Mi Configuraci√≥n VPN" class="w-full bg-gray-600 p-2 rounded text-sm">
            </div>
            <div>
              <label class="block text-sm mb-1">Puerto HTTP:</label>
              <input id="httpPort" type="number" value="7890" class="w-full bg-gray-600 p-2 rounded text-sm">
            </div>
            <div>
              <label class="block text-sm mb-1">Puerto SOCKS5:</label>
              <input id="socksPort" type="number" value="7891" class="w-full bg-gray-600 p-2 rounded text-sm">
            </div>
            <div>
              <label class="flex items-center cursor-pointer">
                <input id="allowLan" type="checkbox" class="mr-2">
                <span class="text-sm">Permitir LAN</span>
              </label>
            </div>
            <div>
              <label class="flex items-center cursor-pointer">
                <input id="enableIPv6" type="checkbox" class="mr-2">
                <span class="text-sm">Habilitar IPv6</span>
              </label>
            </div>
          </div>
        </div>

        <div class="bg-gray-700 p-4 rounded-lg">
          <h2 class="text-lg font-semibold mb-3 flex items-center">
            <span class="mr-2">üìã</span> Opciones de Reglas
          </h2>
          <div class="space-y-2">
            <label class="flex items-center cursor-pointer">
              <input id="ruleStreaming" type="checkbox" checked class="mr-2">
              <span class="text-sm">Reglas de Streaming (Netflix, Disney+, etc.)</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input id="ruleSocial" type="checkbox" checked class="mr-2">
              <span class="text-sm">Redes Sociales (Facebook, Twitter, Instagram)</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input id="ruleGoogle" type="checkbox" checked class="mr-2">
              <span class="text-sm">Servicios Google y YouTube</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input id="ruleAI" type="checkbox" checked class="mr-2">
              <span class="text-sm">Servicios de IA (ChatGPT, Claude, etc.)</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input id="ruleGaming" type="checkbox" checked class="mr-2">
              <span class="text-sm">Gaming y Entretenimiento</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input id="ruleAds" type="checkbox" checked class="mr-2">
              <span class="text-sm">Bloqueo de Anuncios</span>
            </label>
          </div>
        </div>
      </div>

      <div class="mb-6 p-4 bg-gray-700 rounded-lg">
        <h2 class="text-lg font-semibold mb-2">üìã Instrucciones:</h2>
        <ul class="text-sm text-gray-300 space-y-1">
          <li>‚Ä¢ Soporta: vmess://, vless://, trojan://, ss:// (Shadowsocks)</li>
          <li>‚Ä¢ Pega tus enlaces (uno por l√≠nea)</li>
          <li>‚Ä¢ Configura las opciones seg√∫n tus necesidades</li>
          <li>‚Ä¢ Haz clic en "Generar YAML Profesional"</li>
        </ul>
      </div>

      <textarea 
        id="input" 
        class="w-full h-80 p-4 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm" 
        placeholder="Pega aqu√≠ tus enlaces de proxy:
vmess://eyJ2IjoiMiIsInBzIjoiU2Vydmlkb3IgMSIsImFkZCI6IjE5Mi4xNjguMS4xIiwicG9ydCI6IjQ0MyIsImlkIjoiMTIzNDU2NzgtYWJjZC0xMjM0LWFiY2QtMTIzNDU2Nzg5MGFiIiwiYWlkIjoiMCIsIm5ldCI6IndzIiwidHlwZSI6Im5vbmUiLCJob3N0IjoiIiwicGF0aCI6Ii8iLCJ0bHMiOiJ0bHMifQ==
vless://...
trojan://...
ss://..."></textarea>
      
      <div class="mt-4 flex gap-4">
        <button id="generateBtn" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold py-3 rounded-lg transition-all transform hover:scale-105">
          üöÄ Generar YAML Profesional
        </button>
        <button id="clearBtn" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-all">
          üóëÔ∏è Limpiar
        </button>
      </div>

      <div id="result" class="mt-6 hidden">
        <div class="bg-green-900/30 border border-green-500 rounded-lg p-4 mb-4">
          <p class="text-green-400 font-semibold">‚úÖ Archivo generado exitosamente</p>
          <p class="text-sm text-gray-300 mt-1">
            Proxies: <span id="proxyCount" class="font-bold">0</span> | 
            Grupos: <span id="groupCount" class="font-bold">0</span> | 
            Reglas: <span id="ruleCount" class="font-bold">0</span>
          </p>
        </div>
        
        <a id="downloadLink" class="block w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-3 rounded-lg text-center transition-all transform hover:scale-105 mb-4">
          ‚¨áÔ∏è Descargar config.yaml
        </a>

        <div class="bg-gray-700 p-4 rounded-lg">
          <div class="flex justify-between items-center mb-2">
            <h3 class="font-semibold">Vista previa del archivo:</h3>
            <button id="copyBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-1 rounded text-sm">
              üìã Copiar
            </button>
          </div>
          <pre id="preview" class="bg-gray-900 p-4 rounded-lg text-xs overflow-x-auto max-h-96 overflow-y-auto"></pre>
        </div>
      </div>

      <div id="error" class="mt-6 hidden">
        <div class="bg-red-900/30 border border-red-500 rounded-lg p-4">
          <p class="text-red-400 font-semibold">‚ùå Error</p>
          <p id="errorMsg" class="text-sm text-gray-300 mt-1"></p>
        </div>
      </div>
    </div>
  </div>

<script>
let yamlContent = '';

function decodeVmess(vmessUrl) {
  try {
    const data = atob(vmessUrl.replace("vmess://", "").trim());
    const parsed = JSON.parse(data);
    parsed.protocol = 'vmess';
    return parsed;
  } catch (err) {
    console.error("Error al decodificar vmess:", err);
    return null;
  }
}

function decodeVless(vlessUrl) {
  try {
    const url = new URL(vlessUrl);
    const params = new URLSearchParams(url.search);
    return {
      protocol: 'vless',
      ps: decodeURIComponent(url.hash.slice(1)) || url.hostname,
      add: url.hostname,
      port: url.port || 443,
      id: url.username,
      net: params.get('type') || 'tcp',
      tls: params.get('security') || '',
      sni: params.get('sni') || url.hostname,
      host: params.get('host') || '',
      path: params.get('path') || '/'
    };
  } catch (err) {
    console.error("Error al decodificar vless:", err);
    return null;
  }
}

function decodeTrojan(trojanUrl) {
  try {
    const url = new URL(trojanUrl);
    const params = new URLSearchParams(url.search);
    return {
      protocol: 'trojan',
      ps: decodeURIComponent(url.hash.slice(1)) || url.hostname,
      add: url.hostname,
      port: url.port || 443,
      password: url.username,
      sni: params.get('sni') || url.hostname,
      net: params.get('type') || 'tcp'
    };
  } catch (err) {
    console.error("Error al decodificar trojan:", err);
    return null;
  }
}

function decodeShadowsocks(ssUrl) {
  try {
    const url = ssUrl.replace('ss://', '');
    const [encodedPart, name] = url.split('#');
    const decoded = atob(encodedPart.split('@')[0]);
    const [method, password] = decoded.split(':');
    const [server, port] = encodedPart.split('@')[1].split(':');
    
    return {
      protocol: 'ss',
      ps: name ? decodeURIComponent(name) : server,
      add: server,
      port: port,
      password: password,
      cipher: method
    };
  } catch (err) {
    console.error("Error al decodificar shadowsocks:", err);
    return null;
  }
}

function parseProxy(line) {
  if (line.startsWith('vmess://')) return decodeVmess(line);
  if (line.startsWith('vless://')) return decodeVless(line);
  if (line.startsWith('trojan://')) return decodeTrojan(line);
  if (line.startsWith('ss://')) return decodeShadowsocks(line);
  return null;
}

function generateProxyConfig(proxy, index) {
  const name = proxy.ps || `Servidor-${index + 1}`;
  let config = `  - name: "${name}"\n`;

  if (proxy.protocol === 'vmess') {
    config += `    type: vmess
    server: ${proxy.add}
    port: ${proxy.port || 443}
    uuid: ${proxy.id}
    alterId: ${proxy.aid || 0}
    cipher: ${proxy.scy || 'auto'}
    udp: true
    network: ${proxy.net || 'ws'}`;
    
    if (proxy.tls === "tls") {
      config += `\n    tls: true\n    servername: ${proxy.sni || proxy.host || proxy.add}`;
      if (proxy.skip) config += `\n    skip-cert-verify: ${proxy.skip === '1'}`;
    }
    
    if (proxy.net === "ws") {
      config += `\n    ws-opts:\n      path: ${proxy.path || '/'}`;
      if (proxy.host) config += `\n      headers:\n        Host: ${proxy.host}`;
    }
    
    if (proxy.net === "grpc") {
      config += `\n    grpc-opts:\n      grpc-service-name: ${proxy.path || 'grpc'}`;
    }
  } 
  else if (proxy.protocol === 'vless') {
    config += `    type: vless
    server: ${proxy.add}
    port: ${proxy.port}
    uuid: ${proxy.id}
    udp: true
    network: ${proxy.net}`;
    
    if (proxy.tls) {
      config += `\n    tls: true\n    servername: ${proxy.sni}`;
    }
    
    if (proxy.net === 'ws') {
      config += `\n    ws-opts:\n      path: ${proxy.path}`;
      if (proxy.host) config += `\n      headers:\n        Host: ${proxy.host}`;
    }
  }
  else if (proxy.protocol === 'trojan') {
    config += `    type: trojan
    server: ${proxy.add}
    port: ${proxy.port}
    password: ${proxy.password}
    udp: true
    sni: ${proxy.sni}`;
  }
  else if (proxy.protocol === 'ss') {
    config += `    type: ss
    server: ${proxy.add}
    port: ${proxy.port}
    cipher: ${proxy.cipher}
    password: ${proxy.password}
    udp: true`;
  }
  
  return config;
}

function generateClashYaml(proxies, options) {
  const date = new Date().toLocaleString('es-ES');
  
  let yaml = `# ${options.profileName}
# Generado: ${date}
# Total de Proxies: ${proxies.length}

port: ${options.httpPort}
socks-port: ${options.socksPort}
redir-port: 7892
mixed-port: 7893
allow-lan: ${options.allowLan}
bind-address: "*"
mode: rule
log-level: info
ipv6: ${options.enableIPv6}
external-controller: 127.0.0.1:9090
external-ui: ui
secret: ""

dns:
  enable: true
  ipv6: ${options.enableIPv6}
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "+.msftncsi.com"
    - "+.msftconnecttest.com"
  nameserver:
    - 8.8.8.8
    - 1.1.1.1
    - 208.67.222.222
  fallback:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query

proxies:
`;

  proxies.forEach((p, i) => {
    yaml += generateProxyConfig(p, i) + '\n\n';
  });

  const proxyNames = proxies.map((p, i) => `"${p.ps || `Servidor-${i + 1}`}"`);

  yaml += `proxy-groups:
  - name: "üöÄ Selecci√≥n Manual"
    type: select
    proxies:
      - "‚ôªÔ∏è Auto-Selecci√≥n"
      - "üîÑ Fallback"
      - "‚öñÔ∏è Balance"
      - "üéØ DIRECTO"
${proxyNames.map(name => `      - ${name}`).join('\n')}

  - name: "‚ôªÔ∏è Auto-Selecci√≥n"
    type: url-test
    proxies:
${proxyNames.map(name => `      - ${name}`).join('\n')}
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    tolerance: 50

  - name: "üîÑ Fallback"
    type: fallback
    proxies:
${proxyNames.map(name => `      - ${name}`).join('\n')}
    url: "http://www.gstatic.com/generate_204"
    interval: 300

  - name: "‚öñÔ∏è Balance"
    type: load-balance
    strategy: consistent-hashing
    proxies:
${proxyNames.map(name => `      - ${name}`).join('\n')}
    url: "http://www.gstatic.com/generate_204"
    interval: 300
`;

  if (options.ruleStreaming) {
    yaml += `
  - name: "üé¨ Streaming"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "‚ôªÔ∏è Auto-Selecci√≥n"
${proxyNames.map(name => `      - ${name}`).join('\n')}
`;
  }

  if (options.ruleSocial) {
    yaml += `
  - name: "üì± Redes Sociales"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "‚ôªÔ∏è Auto-Selecci√≥n"
${proxyNames.map(name => `      - ${name}`).join('\n')}
`;
  }

  if (options.ruleGoogle) {
    yaml += `
  - name: "üîç Google"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "‚ôªÔ∏è Auto-Selecci√≥n"
${proxyNames.map(name => `      - ${name}`).join('\n')}
`;
  }

  if (options.ruleAI) {
    yaml += `
  - name: "ü§ñ Servicios IA"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "‚ôªÔ∏è Auto-Selecci√≥n"
${proxyNames.map(name => `      - ${name}`).join('\n')}
`;
  }

  if (options.ruleGaming) {
    yaml += `
  - name: "üéÆ Gaming"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "üéØ DIRECTO"
${proxyNames.map(name => `      - ${name}`).join('\n')}
`;
  }

  if (options.ruleAds) {
    yaml += `
  - name: "üõ°Ô∏è Bloqueo Anuncios"
    type: select
    proxies:
      - REJECT
      - "üéØ DIRECTO"
`;
  }

  yaml += `
  - name: "üéØ DIRECTO"
    type: select
    proxies:
      - DIRECT

  - name: "üêü Otros"
    type: select
    proxies:
      - "üöÄ Selecci√≥n Manual"
      - "üéØ DIRECTO"
      - "‚ôªÔ∏è Auto-Selecci√≥n"

rules:
`;

  let ruleCount = 0;

  if (options.ruleAds) {
    yaml += `  # Bloqueo de Anuncios
  - DOMAIN-SUFFIX,doubleclick.net,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,googleadservices.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,googlesyndication.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,googletagservices.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-KEYWORD,adservice,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-KEYWORD,analytics,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-KEYWORD,advertise,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,ads.google.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,adcolony.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,applovin.com,üõ°Ô∏è Bloqueo Anuncios
  - DOMAIN-SUFFIX,unity3d.com,üõ°Ô∏è Bloqueo Anuncios
`;
    ruleCount += 11;
  }

  if (options.ruleStreaming) {
    yaml += `
  # Servicios de Streaming
  - DOMAIN-SUFFIX,netflix.com,üé¨ Streaming
  - DOMAIN-SUFFIX,nflxvideo.net,üé¨ Streaming
  - DOMAIN-SUFFIX,nflximg.net,üé¨ Streaming
  - DOMAIN-SUFFIX,disneyplus.com,üé¨ Streaming
  - DOMAIN-SUFFIX,hulu.com,üé¨ Streaming
  - DOMAIN-SUFFIX,primevideo.com,üé¨ Streaming
  - DOMAIN-SUFFIX,hbomax.com,üé¨ Streaming
  - DOMAIN-SUFFIX,spotify.com,üé¨ Streaming
  - DOMAIN-SUFFIX,twitch.tv,üé¨ Streaming
  - DOMAIN-SUFFIX,dazn.com,üé¨ Streaming
  - DOMAIN-KEYWORD,netflix,üé¨ Streaming
  - DOMAIN-KEYWORD,disney,üé¨ Streaming
`;
    ruleCount += 12;
  }

  if (options.ruleSocial) {
    yaml += `
  # Redes Sociales
  - DOMAIN-SUFFIX,facebook.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,fbcdn.net,üì± Redes Sociales
  - DOMAIN-SUFFIX,instagram.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,cdninstagram.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,twitter.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,x.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,twimg.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,tiktok.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,telegram.org,üì± Redes Sociales
  - DOMAIN-SUFFIX,whatsapp.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,reddit.com,üì± Redes Sociales
  - DOMAIN-SUFFIX,snapchat.com,üì± Redes Sociales
`;
    ruleCount += 12;
  }

  if (options.ruleGoogle) {
    yaml += `
  # Servicios Google
  - DOMAIN-SUFFIX,google.com,üîç Google
  - DOMAIN-SUFFIX,google.com.hk,üîç Google
  - DOMAIN-SUFFIX,googleapis.com,üîç Google
  - DOMAIN-SUFFIX,googleapis.cn,üîç Google
  - DOMAIN-SUFFIX,googleusercontent.com,üîç Google
  - DOMAIN-SUFFIX,gstatic.com,üîç Google
  - DOMAIN-SUFFIX,youtube.com,üîç Google
  - DOMAIN-SUFFIX,ytimg.com,üîç Google
  - DOMAIN-SUFFIX,googlevideo.com,üîç Google
  - DOMAIN-SUFFIX,gmail.com,üîç Google
  - DOMAIN-SUFFIX,gvt1.com,üîç Google
  - DOMAIN-KEYWORD,google,üîç Google
  - DOMAIN-KEYWORD,youtube,üîç Google
`;
    ruleCount += 13;
  }

  if (options.ruleAI) {
    yaml += `
  # Servicios de IA
  - DOMAIN-SUFFIX,openai.com,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,ai.com,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,anthropic.com,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,claude.ai,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,gemini.google.com,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,midjourney.com,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,perplexity.ai,ü§ñ Servicios IA
  - DOMAIN-SUFFIX,character.ai,ü§ñ Servicios IA
  - DOMAIN-KEYWORD,openai,ü§ñ Servicios IA
  - DOMAIN-KEYWORD,chatgpt,ü§ñ Servicios IA
`;
    ruleCount += 10;
  }

  if (options.ruleGaming) {
    yaml += `
  # Gaming y Entretenimiento
  - DOMAIN-SUFFIX,steampowered.com,üéÆ Gaming
  - DOMAIN-SUFFIX,steamcommunity.com,üéÆ Gaming
  - DOMAIN-SUFFIX,epicgames.com,üéÆ Gaming
  - DOMAIN-SUFFIX,ea.com,üéÆ Gaming
  - DOMAIN-SUFFIX,origin.com,üéÆ Gaming
  - DOMAIN-SUFFIX,blizzard.com,üéÆ Gaming
  - DOMAIN-SUFFIX,battle.net,üéÆ Gaming
  - DOMAIN-SUFFIX,riotgames.com,üéÆ Gaming
  - DOMAIN-SUFFIX,minecraft.net,üéÆ Gaming
  - DOMAIN-SUFFIX,xbox.com,üéÆ Gaming
  - DOMAIN-SUFFIX,playstation.com,üéÆ Gaming
`;
    ruleCount += 11;
  }

  yaml += `
  # Reglas generales
  - DOMAIN-SUFFIX,github.com,üöÄ Selecci√≥n Manual
  - DOMAIN-SUFFIX,githubusercontent.com,üöÄ Selecci√≥n Manual
  - DOMAIN-SUFFIX,amazon.com,üöÄ Selecci√≥n Manual
  - DOMAIN-SUFFIX,microsoft.com,üöÄ Selecci√≥n Manual
  - DOMAIN-SUFFIX,live.com,üöÄ Selecci√≥n Manual
  - GEOIP,CN,üéØ DIRECTO
  - MATCH,üêü Otros
`;
  ruleCount += 7;

  return { yaml, ruleCount };
}

function showError(message) {
  const errorDiv = document.getElementById("error");
  const errorMsg = document.getElementById("errorMsg");
  errorMsg.textContent = message;
  errorDiv.classList.remove("hidden");
  document.getElementById("result").classList.add("hidden");
}

function hideError() {
  document.getElementById("error").classList.add("hidden");
}

document.getElementById("generateBtn").addEventListener("click", () => {
  hideError();
  
  const input = document.getElementById("input").value.trim();
  if (!input) {
    showError("Por favor, pega tus enlaces de proxy");
    return;
  }

  const lines = input.split(/\n+/).map(l => l.trim()).filter(l => 
    l.startsWith("vmess://") || l.startsWith("vless://") || 
    l.startsWith("trojan://") || l.startsWith("ss://")
  );
  
  if (lines.length === 0) {
    showError("No se encontraron enlaces v√°lidos. Soporta: vmess://, vless://, trojan://, ss://");
    return;
  }

  const proxies = lines.map(parseProxy).filter(Boolean);
  
  if (proxies.length === 0) {
    showError("No se pudieron decodificar los enlaces. Verifica que sean v√°lidos.");
    return;
  }

  const options = {
    profileName: document.getElementById("profileName").value,
    httpPort: document.getElementById("httpPort").value,
    socksPort: document.getElementById("socksPort").value,
    allowLan: document.getElementById("allowLan").checked,
    enableIPv6: document.getElementById("enableIPv6").checked,
    ruleStreaming: document.getElementById("ruleStreaming").checked,
    ruleSocial: document.getElementById("ruleSocial").checked,
    ruleGoogle: document.getElementById("ruleGoogle").checked,
    ruleAI: document.getElementById("ruleAI").checked,
    ruleGaming: document.getElementById("ruleGaming").checked,
    ruleAds: document.getElementById("ruleAds").checked
  };

  const { yaml, ruleCount } = generateClashYaml(proxies, options);
  yamlContent = yaml;

  const groupCount = 4 + 
    (options.ruleStreaming ? 1 : 0) +
    (options.ruleSocial ? 1 : 0) +
    (options.ruleGoogle ? 1 : 0) +
    (options.ruleAI ? 1 : 0) +
    (options.ruleGaming ? 1 : 0) +
    (options.ruleAds ? 1 : 0) + 2;

  const blob = new Blob([yamlContent], { type: "text/yaml;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  
  const link = document.getElementById("downloadLink");
  link.href = url;
  link.download = "config.yaml";
  
  document.getElementById("proxyCount").textContent = proxies.length;
  document.getElementById("groupCount").textContent = groupCount;
  document.getElementById("ruleCount").textContent = ruleCount;
  document.getElementById("preview").textContent = yamlContent;
  document.getElementById("result").classList.remove("hidden");
});

document.getElementById("clearBtn").addEventListener("click", () => {
  document.getElementById("input").value = "";
  document.getElementById("result").classList.add("hidden");
  hideError();
});

document.getElementById("copyBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(yamlContent).then(() => {
    const btn = document.getElementById("copyBtn");
    const originalText = btn.textContent;
    btn.textContent = "‚úÖ Copiado!";
    btn.classList.add("bg-green-600");
    btn.classList.remove("bg-blue-600");
    setTimeout(() => {
      btn.textContent = originalText;
      btn.classList.remove("bg-green-600");
      btn.classList.add("bg-blue-600");
    }, 2000);
  }).catch(err => {
    alert("Error al copiar: " + err);
  });
});
</script>
</body>
</html>